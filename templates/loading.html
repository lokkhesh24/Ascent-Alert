{% extends "base.html" %}

{% block title %}Loading AscentAlert{% endblock %}

{% block head_extra %}
<style>
    /* Styles specific to loading page, ensuring they override base.html if needed */
    .navbar, .site-footer { display: none !important; }
    body.loading-active {
        overflow: hidden;
        background-color: var(--background-color); /* Use theme color */
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        color: var(--text-color-primary);
    }
    .loading-content-wrapper { /* New wrapper for better centering and structure */
        text-align: center;
    }
    .speedometer-container { /* Renamed from loading-container */
        position: relative;
        width: 300px; /* Adjust as needed */
        height: 180px; /* Half of width for semi-circle + space */
        margin: 0 auto var(--spacing-xl) auto;
    }
    .speedometer-svg {
        width: 100%;
        height: auto;
        display: block;
    }
    .speedometer-bg { /* Background arc */
        fill: none;
        stroke: var(--border-color); /* Use theme border color */
        stroke-width: 30;
        stroke-linecap: round;
    }
    .speedometer-progress { /* Progress arc */
        fill: none;
        stroke: var(--primary-color); /* Use theme primary color */
        stroke-width: 30;
        stroke-linecap: round;
        stroke-dasharray: 471; /* Approx circumference of a 150 radius circle (pi * 300), then halved for semi-circle */
        stroke-dashoffset: 471;
        transition: stroke-dashoffset 0.2s linear, stroke 0.3s ease;
    }
    .speedometer-needle {
        fill: var(--accent-color); /* Use theme accent for needle */
        transform-origin: center 150px; /* Assuming SVG center is around 150,150 */
        transition: transform 0.2s linear;
        /* Needle shape: a simple triangle */
    }
    .speedometer-center-disc {
        fill: var(--accent-gray);
    }
    .speedometer-text {
        font-family: var(--font-family-headings);
        font-size: clamp(1.8rem, 4vw, 2.5rem);
        font-weight: 700;
        fill: var(--text-color-primary);
        text-anchor: middle;
    }
    .loading-title-text { /* For "AscentAlert" */
        font-family: var(--font-family-headings); /* Or 'Racing Sans One' for special title */
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 900;
        margin-bottom: var(--spacing-sm);
        color: var(--text-color-primary);
    }
    .loading-title-text .logo-accent { color: var(--primary-color); }

    .driving-tips-loading {
        font-family: var(--font-family-body);
        font-size: clamp(0.9rem, 1.8vw, 1.1rem);
        color: var(--text-color-secondary);
        margin-top: var(--spacing-md);
        min-height: 2.5em; /* Reserve space for two lines of text */
    }
    /* Hide script tags from rendering if any slip through */
    script { display: none; }
</style>
{% endblock %}

{% block content %}
<div class="loading-content-wrapper">
    <div class="speedometer-container">
        <svg id="speedometerSvg" class="speedometer-svg" viewBox="0 0 300 180">
            <!-- Background Arc (Semi-circle) -->
            <path class="speedometer-bg" d="M 30 150 A 120 120 0 0 1 270 150" />
            <!-- Progress Arc -->
            <path id="speedometerProgress" class="speedometer-progress" d="M 30 150 A 120 120 0 0 1 270 150" />
            <!-- Needle -->
            <polygon id="speedometerNeedle" class="speedometer-needle" points="150,150 145,40 155,40" transform="rotate(-90 150 150)" />
            <!-- Center Disc for Needle -->
            <circle class="speedometer-center-disc" cx="150" cy="150" r="10" />
            <!-- Speed Text -->
            <text id="speedometerText" class="speedometer-text" x="150" y="130">0%</text>
        </svg>
    </div>
    <h1 class="loading-title-text">Ascent<span class="logo-accent">Alert</span></h1>
    <div class="driving-tips-loading">
        <p id="tipTextLoading">Initializing safety protocols...</p>
    </div>
</div>

<script>
    document.body.classList.add('loading-active'); // Apply special body styles

    const speedTextElement = document.getElementById('speedometerText');
    const needleElement = document.getElementById('speedometerNeedle');
    const progressElement = document.getElementById('speedometerProgress');
    const tipTextElement = document.getElementById('tipTextLoading');

    const MAX_PERCENTAGE = 100;
    const ANIMATION_DURATION = 3000; // 3 seconds
    const UPDATE_INTERVAL = 50; // ms
    let currentPercentage = 0;
    const increment = (MAX_PERCENTAGE / (ANIMATION_DURATION / UPDATE_INTERVAL));

    // For semi-circle path d="M 30 150 A 120 120 0 0 1 270 150"
    // Radius is 120. Circumference of full circle = 2 * PI * 120 approx 754.
    // For semi-circle, length is approx 377.
    const progressArcLength = 377; // Approximate length of the semi-circular path
    progressElement.style.strokeDasharray = progressArcLength;
    progressElement.style.strokeDashoffset = progressArcLength;


    const tips = [
        "Always check your brakes before a descent.",
        "Use engine braking on steep slopes.",
        "Honk at blind turns to alert oncoming traffic.",
        "Avoid overtaking on hairpin bends.",
        "Maintain a safe distance, especially in wet conditions.",
        "Be cautious of fog and reduced visibility.",
        "Watch out for wildlife crossing the road.",
        "Ensure your tires have adequate tread.",
        "Plan your journey to avoid driving in extreme weather.",
        "Stay alert, ghat roads demand full attention."
    ];
    let tipIndex = 0;

    function updateTip() {
        tipTextElement.textContent = tips[tipIndex];
        tipIndex = (tipIndex + 1) % tips.length;
    }
    updateTip(); // Show first tip immediately
    const tipInterval = setInterval(updateTip, 2000); // Change tip every 2 seconds

    const loadingInterval = setInterval(() => {
        currentPercentage += increment;
        if (currentPercentage >= MAX_PERCENTAGE) {
            currentPercentage = MAX_PERCENTAGE;
            clearInterval(loadingInterval);
            clearInterval(tipInterval);
            // Redirect to home page after loading completes
            window.location.href = "{{ url_for('index') }}";
        }

        speedTextElement.textContent = `${Math.round(currentPercentage)}%`;
        
        // Needle rotation: -90 degrees is 0%, +90 degrees is 100%. Total 180 degrees.
        const needleAngle = (currentPercentage / MAX_PERCENTAGE) * 180 - 90;
        needleElement.setAttribute('transform', `rotate(${needleAngle} 150 150)`);

        // Progress arc
        const progressOffset = progressArcLength - (currentPercentage / MAX_PERCENTAGE) * progressArcLength;
        progressElement.style.strokeDashoffset = progressOffset;

    }, UPDATE_INTERVAL);
</script>
{% endblock %}

{% block scripts_extra %}
<!-- No extra scripts needed for loading page usually -->
{% endblock %}
